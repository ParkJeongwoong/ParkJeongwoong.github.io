{"pageProps":{"markdown":"# [Spring] 리다이렉트 & 인터셉터\r\n\r\n접근 권한이 없거나 페이지가 존재하지 않는 등 사용자가 요청한 URL이 아닌 다른 URL로 페이지를 이동시켜야 할 때가 있습니다.\r\n\r\n이렇게 특정 조건을 만족할 때 URL을 이동시키기 위해 사용할 수 있는 것이 **Redirect**와 **Intercept**입니다.\r\n\r\n\r\n\r\n## 리다이렉트\r\n\r\n> return \"redirect:주소\";\r\n\r\nRedirect는 Controller의 Method 내부에서 **View를 분기하는 방법**입니다.\r\n\r\n조건에 따라 다른 Return 값을 설정함으로써 구현하는데 일반적으로 return하는 값은 `\"View의 이름\"`이지만 리다이렉트는 단순히 View만 마꾸는 것이 아니라 주소 자체를 이동시켜야 하기 때문에 `\"redirect:이동할 주소\"`를 return시킨다는 차이점이 있습니다.\r\n\r\n\r\n\r\n```java\r\n@Controller\r\n@RequestMapping(\"/member\")\r\npublic class MemberController {\r\n    \r\n    ...\r\n    \r\n    @RequestMapping(value=\"/modifyForm\")\r\n\tpublic String modifyForm(Model model, HttpServletRequest request) {\r\n    \r\n    \tHttpSession session = request.getSession();\r\n\t    Member member = (Member) session.getAttribute(\"member\");\r\n    \r\n    \tif (member == null)\r\n    \t\treturn \"redirect:/\"; // 사용자를 '/'를 주소로 리다이렉트 시킵니다.\r\n\r\n\t    model.addAttribute(\"member\", service.memberSearch(memver));\r\n    \r\n    \treturn \"/member/modifyform\"; // webapp - WEB-INF - view - member 위치에 있는 modifyform.jsp 파일을 View로 반환합니다.\r\n\t}\r\n    \r\n    ...\r\n    \r\n}\r\n```\r\n\r\n\r\n\r\n## 인터셉터\r\n\r\n> public class MemberLoginInterceptor extends HandlerInterceptorAdapter {\r\n>\r\n> ​\t@Override\r\n>\r\n> ​\tpublic boolean preHandle(...) {...}\r\n>\r\n> }\r\n\r\nHandler Interceptor는 DispatcherServlet과 Controller(Handler) 사이에서 <u>Controller 실행 전/후</u>에 **HttpRequest**와 **HttpResponse**를 가로채는 역할을 합니다.\r\n\r\n로그인을 해야만 접근할 수 있는 페이지를 리다이렉트만으로 구현하려면 각 메서드마다 로그인 여부를 확인하고 리다이렉트를 결정하는 코드가 필요합니다. 페이지의 수가 적다면 괜찮겠지만 굉장히 많거나 서비스가 발전하며 늘어난다면 굉장히 많은 중복 코드가 생기게 됩니다.\r\n\r\n인터셉터(일반적으로 많이 사용하는 Request를 가로채는 preHandler)는 Controller에 진입하기 전에 HttpRequest를 먼저 확인하기 때문에 여기서 로그인 여부를 확인하면 코드의 중복을 줄이고 확장성을 높일 수 있습니다.\r\n\r\n\r\n\r\n![image-20211218190358477](../../../../public/assets/image-20211218190358477.png)\r\n\r\n\r\n\r\n### 인터셉터의 종류\r\n\r\n- preHandle() : Controller 전 **\\*가장 많이 쓰임 (redirect 대체)**\r\n- postHandle() : Controller 후\r\n- afterCompletion() : View까지 작업 후\r\n\r\n\r\n\r\n### 인터셉터의 사용\r\n\r\n#### Interceptor Class 구현\r\n\r\n인터셉터를 구현하기 위해서는 Interceptor 클래스를 만들고 **HandlerInterceptor**, **HandlerInterceptorAdapter** 중 하나를 선택하여 상속합니다.\r\n\r\n- **HandlerInterceptor** : 인터페이스 - `implement` 사용\r\n- **HandlerInterceptorAdapter** : 추상 클래스 - `extends` 사용 (<u>메서드가 구현되어 있어서 편리하기 때문에 많이 사용</u>)\r\n\r\n\r\n\r\n[**HandlerInterceptor**]\r\n\r\n```java\r\npublic class MemberLoginInterceptor extends HandlerInterceptorAdapter {\r\n\r\n\t@Override\r\n\tpublic boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\r\n\t\t\r\n\t\tHttpSession session = request.getSession(false);\r\n        \r\n\t\tif (session != null) {\r\n            Object obj = session.getAttribute(\"member\");\r\n            if (obj != null)\r\n                \treturn true\r\n        }\r\n        \r\n\t\tresponse.sendRedirect(request.getContextPath() + \"/\");\r\n\t\t\r\n        return false;\r\n\t\r\n    }\r\n\t\r\n\t@Override\r\n\tpublic void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {\r\n\t\t\r\n\t\tsuper.postHandle(request, response, handler, modelAndView);\r\n        \r\n\t}\r\n\t\r\n\t@Override\r\n\tpublic void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\r\n\t\t\r\n\t\tsuper.afterCompletion(request, response, handler, ex);\r\n        \r\n\t}\r\n    \r\n}\r\n```\r\n\r\n인터페이스이기 때문에 모든 메서드를 구현합니다.\r\n\r\n\r\n\r\n[**HandlerInterceptorAdapter**]\r\n\r\n```java\r\npublic class MemberLoginInterceptor extends HandlerInterceptorAdapter {\r\n    \r\n    @Override\r\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object Handler) throws Exception {\r\n        \r\n        HttpSession Session = request.getSessiont(false);\r\n        if (session != null) {\r\n            Object obj = session.getAttribute(\"member\");\r\n            if (obj != null)\r\n                \treturn true\r\n        }\r\n        \r\n        response.sendRedirect(request.getContextPath() + \"/\");\r\n        return false;\r\n            \r\n    }\r\n    \r\n}\r\n```\r\n\r\n필요한 메서드만 구현합니다.\r\n\r\n\r\n\r\n#### 스프링 설정파일 등록\r\n\r\n구현한 Interceptor가 동작하기 위해서는 스프링 설정 파일에 Interceptor를 등록해야 합니다.\r\n\r\n```xml\r\n<interceptors>\r\n\t<interceptor>\r\n        <!-- path=\"/**\"를 사용하면 모든 경로를 가로챕니다 -->\r\n    \t<mapping path=\"/member/modifyForm\"/>\r\n        <mapping path=\"/memver/removeForm\"/>\r\n        <beans:bean class=\"com.jw.lec21.member.MemberLoginInterceptor\"/>\r\n    </interceptor>\r\n</interceptors>\r\n```\r\n\r\nInterceptor 태그에는 <u>요청을 가로채서 넣을 Bean 객체의 위치를 등록</u>하고 <u>요청을 가로채는 범위(Interceptor가 동작하는 경로)를 mapping</u> 시킵니다.\r\n\r\n\r\n\r\n\r\n\r\n## 출처\r\n\r\n인프런 - 자바 스프링 프레임워크(renew ver.) - 신입 프로그래머를 위한 강좌\r\n\r\nhttps://victorydntmd.tistory.com/176\r\n\r\nhttps://kimvampa.tistory.com/127\r\n\r\nhttps://to-dy.tistory.com/21\r\n","documentTitle":"[Spring] 리다이렉트 & 인터셉터"},"__N_SSG":true}