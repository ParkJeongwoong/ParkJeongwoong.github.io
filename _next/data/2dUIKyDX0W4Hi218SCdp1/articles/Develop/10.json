{"pageProps":{"markdown":"# [GitHub Blog 개발기] 서버 마이그레이션 (AWS => 라즈베리파이 => 오라클 클라우드)\r\n\r\nAWS 프리티어 만료기간이 다가왔다.\r\n\r\n6월부터는 매달 EC2와 RDS 비용을 발생할 예정인데, 최대한 저렴하게 서버를 운용하고 싶어서 서버를 이전하기로 결정했다.\r\n\r\n최종적으로 오라클 클라우드를 선택했고 현재는 완전히 이전이 끝났다.\r\n\r\n\r\n\r\n## 라즈베리파이 서버\r\n\r\n가장 처음 생각한 건 라즈베리 파이로 자체 서버를 돌리는 것이었다.\r\n\r\n초기 비용만 지불하면 이후부터는 전기세 내면 되기 때문이다.\r\n\r\n오라클에서 무료로 제공하는 가상머신이 있다는 건 알고 있었지만, 평생 무료 정책이 언제라도 뒤집힐 수 있다고 생각해서 라즈베리파이 서버를 선택했다. (준비된 HTML, CSS, JS파일을 돌려주는 정적인 작업을 하는 깃헙과는 다르게 동적인 작업은 이용자수가 많아지면 부담이 커질 수도 있다고 생각했다)\r\n\r\n\r\n\r\n라즈베리파이 서버를 구축하는 과정은 다음과 같았다.\r\n\r\n```\r\n1. Ubuntu 22.04 LTS Server 설치\r\n2. Putty를 이용한 22번 포트 SSH 접속 설정\r\n3. Java, Git, MariaDB, Nginx, Certbot 설치\r\n4. System 설정 (Timezone, 사용할 포트 열기)\r\n5. 프로젝트 Pull 받기\r\n6. Spring Config 설정 (application-**.properties 파일에 연결할 DB 주소 변경; MariaDB는 3306포트로 통신)\r\n7. Nginx Config 설정 (80->8080 포트포워딩)\r\n8. SSL 인증서 받고 443->8080 포트포워딩 <<실패>>\r\n```\r\n\r\n라즈베리파이에 우분투를 설치하고 스프링과 DB를 돌리는 것까진 했는데, SSL 인증에서 자꾸 실패했다.\r\n\r\n**no valid A records for ~**이 출력됐는데, 도메인 등록 사이트에 A record로 입력한 IP주소가 유효하지 않다는 이야기였다. (A record에 입력한 IP 주소가 도메인 네임과 연결된다)\r\n\r\n\"IP 주소는 멀쩡한데 뭐가 문제지??\"라고 생각했데 알고보니 내가 입력한 주소는 공유기 내부에서 쓰이는 Private IP라서 외부에서 접근할 수 없는 IP라 그랬던 것이었다.\r\n\r\nPublic IP로 설정을 하니 외부에서도 접속이 가능했는데, 이상하게 80번 포트로는 접근이 안 됐다. (8080 포트는 가능)\r\n\r\n기존에 했던 것처럼 Certbot에서 Standlone으로 SSL 인증서를 발급받고 싶었는데 80번 포트로 접근을 못하면 불가능한 일이었다. \r\n\r\n검색을 하다보니 통신사에서 80번 포트를 막는 경우가 있다는 걸 알게 되었다.\r\n\r\n그래서 일단 블로그 서버는 오라클로 호스팅하고 라즈베리파이 서버는 6월에 이사하고 난 뒤 블로그 말고 다른 쓰임을 찾아보기로 결정했다.\r\n\r\n\r\n\r\n## 오라클 클라우드 (OCI)\r\n\r\n결국 블로그의 서버로 오라클 클라우드을 선택하게 됐고 지금은 완전히 이전을 끝내고 WS로 사용하고 있다.\r\n\r\n\r\n\r\n오라클 클라우드에 서버를 구축하는 과정은 다음과 같았다.\r\n\r\n```\r\n1. Instance 생성 (SSH Key 생성)\r\n2. Putty를 이용한 SSH 접속 설정(PuyyuGen으로 ppk키로 변경 후 등록)\r\n3. Java, Git, MariaDB, Nginx, Certbot 설치\r\n4. System 설정 (Timezone, 사용할 포트 열기)\r\n5. 프로젝트 Pull 받기\r\n6. Spring Config 설정 (application-**.properties 파일에 연결할 DB 주소 변경; MariaDB는 3306포트로 통신)\r\n7. Nginx Config 설정 (80->8080 포트포워딩)\r\n8. 오라클 클라우드에서 고정 IP 할당\r\n9. SSL 인증서 받고 443->8080 포트포워딩\r\n```\r\n\r\n오라클에서도 80번 포트 접속 문제가 있었는데 꽤 오랫동안 해결을 못했다.\r\n\r\n결국 우분투의 ufw를 믿고 iptables는 다 지워버리는 방법을 사용해서 해결했다. (https://blog.elmi.page/412, https://stackoverflow.com/questions/54794217/opening-port-80-on-oracle-cloud-infrastructure-compute-node/54810101#54810101)\r\n\r\n\r\n\r\n서버를 구축한 이후에는 AWS RDS에 있던 데이터를 Dump해서 가져와야 했다.\r\n\r\nMariaDB의 데이터를 Dump하는 과정은 다음과 같았다. (https://velog.io/@prayme/AWS-RDS-dump%ED%95%98%EA%B8%B0)\r\n\r\n```\r\n1. dump.sql 파일 생성 (Dump 받을 컴퓨터에서)\r\nmysqldump -h {접속할 DB 주소} -u {유저 이름} -p {DB 이름} > {저장할 파일 이름}\r\n=> mysqldump -h database-blog.식별자.ap-northeast-2.rds.amazonaws.com -u {RDS DB 유저} -p database_blog > dump.sql\r\n\r\n<<MariaDB 접속>>\r\n2. CREATE USER '유저 이름'@'%' IDENTIFIED BY '비밀번호';\r\n3. GRANT ALL PRIVILEGES ON 데이터베이스.* TO '유저 이름'@'%';\r\n4. CREATE DATABASE 데이터베이스명;\r\n\r\n\r\n5. dump.sql 파일 dump\r\nmysql -u {유저 이름} -p {DB 이름} < dump.sql\r\n=> mysql -u parkjeongwoong -p database_blog < dump.sql\r\n```\r\n\r\n\r\n\r\n","documentTitle":"[GitHub Blog 개발기] 서버 마이그레이션 (AWS => 라즈베리파이 => 오라클 클라우드)","index":[{"type":"type1","data":" [GitHub Blog 개발기] 서버 마이그레이션 (AWS => 라즈베리파이 => 오라클 클라우드)"},{"type":"type2","data":" 라즈베리파이 서버"},{"type":"type2","data":" 오라클 클라우드 (OCI)"}]},"__N_SSG":true}