{"pageProps":{"markdown":"# Certbot, Connection Refused Error (maunal 인증서)\r\n\r\n## 상황\r\n\r\n1. `sudo certbot renew --force-renew`를 이용해서 갱신을 하려니까 다음과 같은 에러가 발생했다.\r\n\r\n```\r\nCert is due for renewal, auto-renewing...\r\nCould not choose appropriate plugin: The manual plugin is not working; there may be problems with your existing configuration.\r\n...\r\nAttempting to renew cert (도메인주소) from /etc/letsencrypt/renewal/도메인주소.conf produced an unexpected error: The manual plugin is not working; there may be problems with your existing configuration.\r\n...\r\n```\r\n\r\n2. 확인해보니 이 에러는 `--manual`을 사용해서 SSL 인증서를 받았을 때 생긴다고 한다.\r\n\r\n3. 방법은 인증서를 삭제 후 다시 인증 받는 것.\r\n\r\n4. `certbot delete`로 인증서 삭제\r\n\r\n5. 그런데 인증이 안 되는 문제 발생\r\n\r\n6. `--standalone`도 `--manual`도 안 됨\r\n\r\n7. 에러는 `Connection Refused Error`\r\n\r\n```\r\nChallenge failed for domain 도메인주소\r\nhttp-01 challenge for 도메인주소\r\nCleaning up challenges\r\nSome challenges have failed.\r\n\r\nIMPORTANT NOTES:\r\n - The following errors were reported by the server:\r\n\r\n   Domain: 도메인주소\r\n   Type:   connection\r\n   Detail: 39.115.83.55: Fetching\r\n   http://도메인주소/.well-known/acme-challenge/EtO5qqrFc2wpH4gHzZ3AwAgSctiHoAMMvk5SU9YyS1c:\r\n   Connection refused\r\n\r\n   To fix these errors, please make sure that your domain name was\r\n   entered correctly and the DNS A/AAAA record(s) for that domain\r\n   contain(s) the right IP address. Additionally, please check that\r\n   your computer has a publicly routable IP address and that no\r\n   firewalls are preventing the server from communicating with the\r\n   client. If you're using the webroot plugin, you should also verify\r\n   that you are serving files from the webroot path you provided.\r\n```\r\n\r\n## 해결\r\n\r\n다음 글을 보고 해결할 수 있었다. [참고](https://www.lesstif.com/system-admin/dns-txt-record-let-s-encrypt-ssl-59343172.html)\r\n\r\n방법은 다음과 같다.\r\n\r\n1. `certbot certonly -d 도메인주소 --manual --preferred-challenges dns`\r\n\r\n2. IP Logging 허용\r\n\r\n3. TXT 주소와 레코드를 확인 후 DNS 서버에 등록\r\n\r\n![20221112certbotmanual](../../../../public/assets/20221112certbotmanual.jpg)","documentTitle":"Certbot, Connection Refused Error (maunal 인증서)","index":[{"type":"type1","data":" Certbot, Connection Refused Error (maunal 인증서)"},{"type":"type2","data":" 상황"},{"type":"type2","data":" 해결"}]},"__N_SSG":true}