{"pageProps":{"markdown":"# Pinpoint - Client IP(REMOTE_ADDRESS) 172.17.0.1\r\n\r\n## 참고 - 현재 구조\r\n\r\n````\r\n[Sever1 (Spring Application(Docker), Pinpoint Agent)] -> [Server2 (Hbase, Pinpoint Web)]\r\n````\r\n\r\n\r\n\r\n## 문제 확인\r\n\r\npinpoint web에서 Client IP가  **172.17.0.1** 로 나오는 게 확인됐다.\r\n\r\n172.17.0.1은 Docker 에서 사용하는 가상 IP인데 중간에 뭔가 잘못 전달하고 있는 걸로 보인다.\r\n\r\n\r\n\r\nClient -> Nginx -> Docker(Spring Application) -> Pinpoint Agent -> Hbase -> Pinpoint Web\r\n\r\n으로 이어지는 과정 중 어딘가가 원인이었는데, `결론적으로는 Nginx와 Pinpoint Agent` 를 수정해 문제를 해결했다.\r\n\r\n\r\n\r\n## 해결 방법\r\n\r\n1. 우선 **Pinpoint Agent의 config에 profiler.tomcat.realipheader=X-Forwarded-For을 추가** 함으로써 .agent가 container의 IP가 아니라 X-Forwarded-For을 바라보도록 만들었다.\r\n\r\n2. Nginx의 Config를 열어 location에 아래의 설정을 추가했다.\r\n\r\n   ```\r\n   proxy_set_header X-Forwarded-Host   $host;\r\n   proxy_set_header X-Real-IP          $remote_addr;\r\n   proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\r\n   ```\r\n\r\n\r\n\r\n## 참고\r\n\r\n[삐에로z - Real Remote Address (reverse proxy 사용)](https://ploz.tistory.com/entry/18-Real-Remote-Address-reverse-proxy-%EC%82%AC%EC%9A%A9)","documentTitle":"Pinpoint - Client IP(REMOTE_ADDRESS) 172.17.0.1","index":[{"type":"type1","data":" Pinpoint - Client IP(REMOTE_ADDRESS) 172.17.0.1"},{"type":"type2","data":" 참고 - 현재 구조"},{"type":"type2","data":" 문제 확인"},{"type":"type2","data":" 해결 방법"},{"type":"type2","data":" 참고"}]},"__N_SSG":true}